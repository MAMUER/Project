<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="https://www.thymeleaf.org">

<head>
    <title>–ú–æ–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</title>
    <link rel="stylesheet" th:href="@{/css/programs.css}">
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
    <script src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js" type="module"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">
    <link rel='stylesheet' href='https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap'>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
</head>

<body>
    <div class="container">
        <!-- –•–µ–¥–µ—Ä -->
        <header class="header">
            <div class="header-content">
                <h1 class="page-title">–ú–æ–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</h1>
                <div class="header-actions">
                    <a th:href="@{/profile/member/{id}(id=${memberId})}" class="back-button">
                        <ion-icon name="arrow-back-outline"></ion-icon>
                        –ù–∞–∑–∞–¥ –≤ –ø—Ä–æ—Ñ–∏–ª—å
                    </a>
                    <a th:href="@{/programs/generate/{id}(id=${memberId})}" class="generate-button">
                        <ion-icon name="add-outline"></ion-icon>
                        –ù–æ–≤–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞
                    </a>
                </div>
            </div>
        </header>

        <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
        <div class="messages" th:if="${success} or ${error}">
            <div class="success-message" th:if="${success}" th:text="${success}"></div>
            <div class="error-message" th:if="${error}" th:text="${error}"></div>
        </div>

        <!-- –ê–∫—Ç–∏–≤–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ -->
        <div class="active-program-section" th:if="${activeProgram}">
            <div class="section-header">
                <h2>–ê–∫—Ç–∏–≤–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</h2>
                <span class="active-badge">–ê–ö–¢–ò–í–ù–ê</span>
            </div>
            <div class="program-card active">
                <div class="program-header">
                    <h3 th:text="${activeProgram.programName}">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã</h3>
                    <div class="program-meta">
                        <span class="meta-item">
                            <ion-icon name="flag-outline"></ion-icon>
                            <span th:text="${activeProgram.goal}">–¶–µ–ª—å</span>
                        </span>
                        <span class="meta-item">
                            <ion-icon name="fitness-outline"></ion-icon>
                            <span th:text="${activeProgram.level}">–£—Ä–æ–≤–µ–Ω—å</span>
                        </span>
                        <span class="meta-item">
                            <ion-icon name="calendar-outline"></ion-icon>
                            <span th:text="${activeProgram.durationWeeks} + ' –Ω–µ–¥–µ–ª—å'">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</span>
                        </span>
                    </div>
                </div>

                <div class="program-days" th:if="${not #lists.isEmpty(sortedProgramDays)}">
                    <!-- –ò–°–ü–û–õ–¨–ó–£–ï–ú –û–¢–°–û–†–¢–ò–†–û–í–ê–ù–ù–´–ï –î–ù–ò -->
                    <div class="day-card" th:each="day : ${sortedProgramDays}">
                        <h4 th:text="${day.dayName} + ' (–î–µ–Ω—å ' + ${day.dayNumber} + ')'">–î–µ–Ω—å</h4>
                        <span class="muscle-groups" th:text="${day.muscleGroups}">–ì—Ä—É–ø–ø—ã –º—ã—à—Ü</span>

                        <div class="exercises-list"
                            th:if="${not #lists.isEmpty(sortedExercisesByDay.get(day.dayNumber))}">
                            <!-- –ò–°–ü–û–õ–¨–ó–£–ï–ú –û–¢–°–û–†–¢–ò–†–û–í–ê–ù–ù–´–ï –£–ü–†–ê–ñ–ù–ï–ù–ò–Ø -->
                            <div class="exercise-item" th:each="exercise : ${sortedExercisesByDay.get(day.dayNumber)}">
                                <div class="exercise-info">
                                    <span class="exercise-name exercise-tooltip-trigger"
                                        th:text="${exercise.exercise.exerciseName}"
                                        th:data-description="${exercise.exercise.description}"
                                        th:data-equipment="${exercise.exercise.equipmentRequired}"
                                        th:data-calories="${exercise.exercise.estimatedCalories}">
                                        –£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ
                                    </span>
                                    <span class="exercise-sets"
                                        th:text="${exercise.sets} + 'x' + ${exercise.reps}">–ü–æ–¥—Ö–æ–¥—ã√ó–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏—è</span>
                                </div>
                                <div class="exercise-details" th:if="${exercise.weight != null}">
                                    <span th:text="${exercise.weight} + ' –∫–≥'">–í–µ—Å</span>
                                </div>
                            </div>
                        </div>
                        <div class="no-exercises" th:if="${#lists.isEmpty(sortedExercisesByDay.get(day.dayNumber))}">
                            <p>–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω—ã</p>
                        </div>
                    </div>
                </div>
                <div class="no-days" th:if="${#lists.isEmpty(sortedProgramDays)}">
                    <p>–î–Ω–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã</p>
                </div>
            </div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è —Å –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ–π –¥–∏–µ—Ç–æ–π –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã -->
        <div class="nutrition-section" th:if="${activeProgram != null and activeProgram.nutritionPlan != null}">
            <div class="section-header">
                <h2>ü•ó –ù–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –ø–ª–∞–Ω –ø–∏—Ç–∞–Ω–∏—è</h2>
            </div>

            <div class="nutrition-cards">
                <div class="nutrition-card">
                    <div class="nutrition-header">
                        <ion-icon name="restaurant-outline"></ion-icon>
                        <h3 th:text="${activeProgram.nutritionPlan.planName}">–ù–∞–∑–≤–∞–Ω–∏–µ –ø–ª–∞–Ω–∞ –ø–∏—Ç–∞–Ω–∏—è</h3>
                    </div>
                    <div class="nutrition-content">
                        <!-- –£–õ–£–ß–®–ï–ù–ù–û–ï –û–ü–ò–°–ê–ù–ò–ï –î–ò–ï–¢–´ -->
                        <div class="nutrition-description">
                            <p th:text="${activeProgram.nutritionPlan.nutritionDescription}">–û–ø–∏—Å–∞–Ω–∏–µ –ø–ª–∞–Ω–∞ –ø–∏—Ç–∞–Ω–∏—è</p>
                            
                            <!-- –ü–û–î–†–û–ë–ù–´–ï –î–ï–¢–ê–õ–ò -->
                            <div class="nutrition-details" th:if="${activeProgram.nutritionPlan.goalType != null or activeProgram.nutritionPlan.difficultyLevel != null}">
                                <div class="detail-item" th:if="${activeProgram.nutritionPlan.goalType != null}">
                                    <strong>–¶–µ–ª—å:</strong> <span th:text="${activeProgram.nutritionPlan.goalType}"></span>
                                </div>
                                <div class="detail-item" th:if="${activeProgram.nutritionPlan.difficultyLevel != null}">
                                    <strong>–£—Ä–æ–≤–µ–Ω—å:</strong> <span th:text="${activeProgram.nutritionPlan.difficultyLevel}"></span>
                                </div>
                            </div>
                        </div>

                        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–∏—Ç–∞–Ω–∏—è, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–∞ -->
                        <div class="nutrition-stats" th:if="${activeProgram.nutritionPlan.caloriesPerDay != null}">
                            <div class="nutrition-stat">
                                <span class="stat-label">–ö–∞–ª–æ—Ä–∏–∏ –≤ –¥–µ–Ω—å:</span>
                                <span class="stat-value"
                                    th:text="${activeProgram.nutritionPlan.caloriesPerDay} + ' –∫–∫–∞–ª'"></span>
                            </div>
                            <div class="nutrition-stat" th:if="${activeProgram.nutritionPlan.proteinPercent != null}">
                                <span class="stat-label">–ë–µ–ª–∫–∏:</span>
                                <span class="stat-value"
                                    th:text="${activeProgram.nutritionPlan.proteinPercent} + '%'"></span>
                            </div>
                            <div class="nutrition-stat" th:if="${activeProgram.nutritionPlan.carbsPercent != null}">
                                <span class="stat-label">–£–≥–ª–µ–≤–æ–¥—ã:</span>
                                <span class="stat-value"
                                    th:text="${activeProgram.nutritionPlan.carbsPercent} + '%'"></span>
                            </div>
                            <div class="nutrition-stat" th:if="${activeProgram.nutritionPlan.fatPercent != null}">
                                <span class="stat-label">–ñ–∏—Ä—ã:</span>
                                <span class="stat-value"
                                    th:text="${activeProgram.nutritionPlan.fatPercent} + '%'"></span>
                            </div>
                        </div>
                    </div>
                    <div class="nutrition-footer">
                        <span class="nutrition-type"
                            th:text="'–¶–µ–ª—å: ' + ${activeProgram.nutritionPlan.goalType} + ' ‚Ä¢ –£—Ä–æ–≤–µ–Ω—å: ' + ${activeProgram.nutritionPlan.difficultyLevel}">
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <div class="empty-nutrition" th:if="${activeProgram != null and activeProgram.nutritionPlan == null}">
            <div class="empty-state">
                <div class="empty-icon">
                    <ion-icon name="restaurant-outline"></ion-icon>
                </div>
                <h3>–ü–ª–∞–Ω –ø–∏—Ç–∞–Ω–∏—è –Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω</h3>
                <p>–î–ª—è –∞–∫—Ç–∏–≤–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã –ø–æ–∫–∞ –Ω–µ —Å–æ–∑–¥–∞–Ω –ø–ª–∞–Ω –ø–∏—Ç–∞–Ω–∏—è</p>
            </div>
        </div>

        <!-- –í—Å–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã -->
        <div class="all-programs-section">
            <div class="section-header">
                <h2>üìÅ –í—Å–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã</h2>
                <span class="programs-count" th:text="${#lists.size(programs)} + ' –ø—Ä–æ–≥—Ä–∞–º–º'"></span>
            </div>

            <div class="programs-grid" th:if="${not #lists.isEmpty(programs)}">
                <div class="program-card" th:each="program : ${programs}"
                    th:classappend="${program.isActive} ? 'active' : ''">
                    <div class="program-header">
                        <h3 th:text="${program.programName}">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã</h3>
                        <div class="program-actions">
                            <form
                                th:action="@{/programs/activate/{memberId}/{programId}(memberId=${memberId}, programId=${program.idProgram})}"
                                method="post" th:if="${not program.isActive}">
                                <button type="submit" class="activate-btn">
                                    <ion-icon name="play-circle-outline"></ion-icon>
                                    –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å
                                </button>
                            </form>
                            <span class="active-indicator" th:if="${program.isActive}">
                                <ion-icon name="checkmark-circle"></ion-icon>
                                –ê–∫—Ç–∏–≤–Ω–∞
                            </span>
                        </div>
                    </div>

                    <div class="program-info">
                        <div class="info-row">
                            <span class="info-label">–¶–µ–ª—å:</span>
                            <span th:text="${program.goal}" class="info-value">–¶–µ–ª—å</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">–£—Ä–æ–≤–µ–Ω—å:</span>
                            <span th:text="${program.level}" class="info-value">–£—Ä–æ–≤–µ–Ω—å</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</span>
                            <span th:text="${program.durationWeeks} + ' –Ω–µ–¥–µ–ª—å'" class="info-value">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">–°–æ–∑–¥–∞–Ω–∞:</span>
                            <span th:text="${#temporals.format(program.createdDate, 'dd.MM.yyyy')}"
                                class="info-value">–î–∞—Ç–∞</span>
                        </div>
                    </div>

                    <div class="program-stats">
                        <div class="stat">
                            <span class="stat-number"
                                th:text="${program.programDays != null ? program.programDays.size() : 0}">0</span>
                            <span class="stat-label">–¥–Ω–µ–π –≤ –Ω–µ–¥–µ–ª—é</span>
                        </div>
                        <div class="stat">
                            <!-- –£–ü–†–û–©–ï–ù–ù–û–ï –í–´–†–ê–ñ–ï–ù–ò–ï –î–õ–Ø –ü–û–î–°–ß–ï–¢–ê –£–ü–†–ê–ñ–ù–ï–ù–ò–ô -->
                            <span class="stat-number"
                                th:text="${program.programDays != null ? #lists.size(program.programDays) : 0}">0</span>
                            <span class="stat-label">—É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="empty-state" th:if="${#lists.isEmpty(programs)}">
                <div class="empty-icon">
                    <ion-icon name="barbell-outline"></ion-icon>
                </div>
                <h3>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</h3>
                <p>–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ—é –ø–µ—Ä–≤—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø–æ –ø–ª–∞–Ω—É</p>
            </div>
        </div>
    </div>

    <!-- –¢—É–ª—Ç–∏–ø –¥–ª—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π -->
    <div id="exercise-tooltip" class="exercise-tooltip">
        <div class="tooltip-content">
            <h4 id="tooltip-title"></h4>
            <p id="tooltip-description"></p>
            <div class="tooltip-details">
                <div id="equipment-detail" style="display: none;">
                    <strong>–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ:</strong> <span id="tooltip-equipment"></span>
                </div>
                <div id="calories-detail" style="display: none;">
                    <strong>–ö–∞–ª–æ—Ä–∏–∏:</strong> <span id="tooltip-calories"></span>
                </div>
            </div>
        </div>
    </div>

    <style>
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç—É–ª—Ç–∏–ø–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π */
        .exercise-tooltip {
            display: none;
            position: absolute; /* –ú–µ–Ω—è–µ–º –Ω–∞ absolute –¥–ª—è –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
            z-index: 99999;
            background: #FFFFFF;
            border: 2px solid #0795E8;
            border-radius: 12px;
            padding: 16px;
            max-width: 300px;
            width: auto;
            box-shadow: 0 10px 40px rgba(7, 149, 232, 0.25);
            pointer-events: none;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        
        .exercise-tooltip .tooltip-content h4 {
            color: #0707E8;
            margin: 0 0 10px 0;
            font-size: 16px;
            font-weight: 600;
        }
        
        .exercise-tooltip .tooltip-content p {
            color: #666666;
            margin: 0 0 12px 0;
            line-height: 1.5;
            font-size: 14px;
        }
        
        .exercise-tooltip .tooltip-details {
            font-size: 13px;
            border-top: 1px solid #E8EEFB;
            padding-top: 10px;
            margin-top: 10px;
        }
        
        .exercise-tooltip .tooltip-details div {
            margin-bottom: 6px;
        }
        
        .exercise-tooltip .tooltip-details strong {
            color: #666666;
        }
        
        .exercise-tooltip .tooltip-details span {
            color: #0707E8;
            font-weight: 600;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç—Ä–∏–≥–≥–µ—Ä–∞ —Ç—É–ª—Ç–∏–ø–∞ */
        .exercise-name.exercise-tooltip-trigger {
            cursor: help;
            border-bottom: 1px dotted #0795E8;
            color: #0795E8;
            position: relative;
            display: inline-block;
        }
        
        .exercise-name.exercise-tooltip-trigger:hover {
            color: #074EE8;
            text-decoration: underline;
        }
        
        /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è –¥–∏–µ—Ç—ã */
        .nutrition-description {
            margin-bottom: 16px;
        }
        
        .nutrition-description p {
            margin-bottom: 12px;
            line-height: 1.5;
        }
        
        .nutrition-details {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px;
            border-radius: 8px;
            margin-top: 12px;
        }
        
        .detail-item {
            margin-bottom: 6px;
            font-size: 14px;
        }
        
        .detail-item:last-child {
            margin-bottom: 0;
        }
        
        .detail-item strong {
            color: rgba(255, 255, 255, 0.9);
        }
        
        .detail-item span {
            color: white;
        }
        
        @media (max-width: 768px) {
            .exercise-tooltip {
                position: fixed !important;
                left: 50% !important;
                transform: translateX(-50%) !important;
                max-width: 90vw;
                top: 50% !important;
                margin-top: 0 !important;
            }
            
            .exercise-name.exercise-tooltip-trigger {
                cursor: pointer;
            }
        }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const tooltip = document.getElementById('exercise-tooltip');
            const tooltipTriggers = document.querySelectorAll('.exercise-tooltip-trigger');
            let activeTrigger = null;
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–æ–≤ (hover)
            tooltipTriggers.forEach(trigger => {
                // Hover –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–æ–≤
                trigger.addEventListener('mouseenter', function(e) {
                    if (window.innerWidth > 768) {
                        showTooltip(this, e);
                    }
                });
                
                trigger.addEventListener('mouseleave', function() {
                    if (window.innerWidth > 768) {
                        hideTooltip();
                    }
                });
                
                // –ö–ª–∏–∫ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
                trigger.addEventListener('click', function(e) {
                    if (window.innerWidth <= 768) {
                        e.preventDefault();
                        
                        if (activeTrigger === this) {
                            hideTooltip();
                            activeTrigger = null;
                        } else {
                            showTooltip(this, e);
                            activeTrigger = this;
                        }
                    }
                });
            });
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ —Ç—É–ª—Ç–∏–ø–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ (–¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö)
            document.addEventListener('click', function(e) {
                if (window.innerWidth <= 768 && 
                    activeTrigger && 
                    !e.target.closest('.exercise-tooltip-trigger') && 
                    !e.target.closest('.exercise-tooltip')) {
                    hideTooltip();
                    activeTrigger = null;
                }
            });
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ ESC
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    hideTooltip();
                    activeTrigger = null;
                }
            });
            
            function showTooltip(trigger, event) {
                // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ data-–∞—Ç—Ä–∏–±—É—Ç–æ–≤
                const title = trigger.textContent;
                const description = trigger.getAttribute('data-description') || '–û–ø–∏—Å–∞–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç';
                const equipment = trigger.getAttribute('data-equipment');
                const calories = trigger.getAttribute('data-calories');
                
                // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç—É–ª—Ç–∏–ø
                document.getElementById('tooltip-title').textContent = title;
                document.getElementById('tooltip-description').textContent = description;
                
                // –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ
                const equipmentDetail = document.getElementById('equipment-detail');
                const equipmentSpan = document.getElementById('tooltip-equipment');
                if (equipment && equipment !== 'null') {
                    equipmentSpan.textContent = equipment;
                    equipmentDetail.style.display = 'block';
                } else {
                    equipmentDetail.style.display = 'none';
                }
                
                // –ö–∞–ª–æ—Ä–∏–∏
                const caloriesDetail = document.getElementById('calories-detail');
                const caloriesSpan = document.getElementById('tooltip-calories');
                if (calories && calories !== 'null') {
                    caloriesSpan.textContent = calories + ' –∫–∫–∞–ª';
                    caloriesDetail.style.display = 'block';
                } else {
                    caloriesDetail.style.display = 'none';
                }
                
                // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º —Ç—É–ª—Ç–∏–ø –†–Ø–î–û–ú –° –≠–õ–ï–ú–ï–ù–¢–û–ú
                const rect = trigger.getBoundingClientRect();
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft;
                
                if (window.innerWidth > 768) {
                    // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º —Å–ø—Ä–∞–≤–∞ –æ—Ç —ç–ª–µ–º–µ–Ω—Ç–∞
                    let left = rect.left + scrollLeft + rect.width + 10;
                    let top = rect.top + scrollTop - 10;
                    
                    // –ï—Å–ª–∏ –Ω–µ –ø–æ–º–µ—â–∞–µ—Ç—Å—è —Å–ø—Ä–∞–≤–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ª–µ–≤–∞
                    if (left + tooltip.offsetWidth > window.innerWidth) {
                        left = rect.left + scrollLeft - tooltip.offsetWidth - 10;
                    }
                    
                    // –ï—Å–ª–∏ –Ω–µ –ø–æ–º–µ—â–∞–µ—Ç—Å—è —Å–≤–µ—Ä—Ö—É, –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º
                    if (top + tooltip.offsetHeight > window.innerHeight + scrollTop) {
                        top = window.innerHeight + scrollTop - tooltip.offsetHeight - 10;
                    }
                    
                    tooltip.style.position = 'absolute';
                    tooltip.style.top = top + 'px';
                    tooltip.style.left = left + 'px';
                    tooltip.style.transform = 'none';
                } else {
                    // –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö - –ø–æ —Ü–µ–Ω—Ç—Ä—É —ç–∫—Ä–∞–Ω–∞
                    tooltip.style.position = 'fixed';
                    tooltip.style.top = '50%';
                    tooltip.style.left = '50%';
                    tooltip.style.transform = 'translate(-50%, -50%)';
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç—É–ª—Ç–∏–ø
                tooltip.style.display = 'block';
                
                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è
                setTimeout(() => {
                    tooltip.style.opacity = '1';
                }, 10);
            }
            
            function hideTooltip() {
                tooltip.style.opacity = '0';
                setTimeout(() => {
                    tooltip.style.display = 'none';
                }, 200);
            }
            
            // –°–∫—Ä—ã–≤–∞–µ–º —Ç—É–ª—Ç–∏–ø –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ (–¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–æ–≤)
            window.addEventListener('scroll', function() {
                if (window.innerWidth > 768) {
                    hideTooltip();
                }
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º transition –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏
            tooltip.style.transition = 'opacity 0.2s ease';
        });
    </script>
</body>

</html>